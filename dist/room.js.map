{"version":3,"sources":["room.ts"],"names":["output","require","towers","terrain","settings","getSettingsForLevel","room","init","rooms","subTimeStart","Game","cpu","getUsed","energyInRooms","returnvalue","_","map","closestHostiles","find","FIND_HOSTILE_CREEPS","Memory","enemys","name","size","getTower","read","canBuildMediumCreep","energyAvailable","generalSettings","costs","medium","canBuildBigCreep","big","containers","FIND_STRUCTURES","filter","structure","structureType","STRUCTURE_CONTAINER","containerToTransfer","undefined","containerToGetFrom","energyAmountInContainer","energyMaxAmountInContainer","containerData","container","pos","id","proxyContainer","store","RESOURCE_ENERGY","storeCapacity","isFull","concat","duration","toFixed","workTimes","module","exports"],"mappings":";;AAAA,IAAIA,SAASC,QAAQ,UAAR,CAAb;AACA,IAAIC,SAASD,QAAQ,SAAR,CAAb;AACA,IAAIE,UAAUF,QAAQ,WAAR,CAAd;AAEA,IAAIG,WAAWH,QAAQ,YAAR,EAAsBI,mBAAtB,EAAf;AAEA,IAAIC,OAAO;AACPC,UAAM,cAACC,KAAD,EAAM;AACR,YAAIC,eAAaC,KAAKC,GAAL,CAASC,OAAT,EAAjB;AACAZ,eAAOa,aAAP,CAAqBL,KAArB;AACA,YAAIM,cAAeC,EAAEC,GAAF,CAAMR,KAAN,EAAa,gBAAI;AAChC;AACA,gBAAIS,kBAAkBX,KAAKY,IAAL,CAAUC,mBAAV,CAAtB;AACAC,mBAAOC,MAAP,CAAcf,KAAKgB,IAAnB,IAA2BP,EAAEQ,IAAF,CAAON,eAAP,CAA3B;AAEA;AACAf,mBAAOsB,QAAP,CAAgBlB,IAAhB;AACAA,mBAAOH,QAAQsB,IAAR,CAAanB,IAAb,CAAP;AAEAA,iBAAKoB,mBAAL,GAA2BpB,KAAKqB,eAAL,IAAwBvB,SAASwB,eAAT,CAAyBC,KAAzB,CAA+BC,MAAlF;AACAxB,iBAAKyB,gBAAL,GAAwBzB,KAAKqB,eAAL,IAAwBvB,SAASwB,eAAT,CAAyBC,KAAzB,CAA+BG,GAA/E;AAEA,gBAAIC,aAAa3B,KAAKY,IAAL,CAAUgB,eAAV,EAA2B;AACxCC,wBAAQ,gBAACC,SAAD,EAAU;AACd,2BAAOA,UAAUC,aAAV,KAA4BC,mBAAnC;AACH;AAHuC,aAA3B,CAAjB;AAMA,gBAAGhC,KAAKiC,mBAAL,KAA6BC,SAAhC,EAA0C;AACtClC,qBAAKiC,mBAAL,GAA2B,EAA3B;AACH;AACD,gBAAGjC,KAAKmC,kBAAL,KAA4BD,SAA/B,EAAyC;AACrClC,qBAAKmC,kBAAL,GAA0B,EAA1B;AACH;AAED,gBAAIC,0BAA0B,CAA9B;AACA,gBAAIC,6BAA6B,CAAjC;AACAV,uBAAWjB,GAAX,CAAe,qBAAS;AACpB,oBAAI4B,gBAAgB,CAAC;AACjB,2BAAMC,UAAUC,GADC;AAEjB,8BAAU;AAFO,iBAAD,CAApB;AAIA,oBAAGD,UAAUE,EAAV,KAAiB3B,OAAO4B,cAAP,CAAsBD,EAA1C,EAA6C;AACzC,wBAAGF,UAAUI,KAAV,CAAgBC,eAAhB,IAAmCL,UAAUM,aAAhD,EAA+D;AAC3DP,sCAAc,CAAd,EAAiBQ,MAAjB,GAA0B,KAA1B;AACA9C,6BAAKiC,mBAAL,GAA2B,GAAGc,MAAH,CAAU/C,KAAKiC,mBAAf,EAAoCK,aAApC,CAA3B;AACH;AACD,wBAAGC,UAAUI,KAAV,CAAgBC,eAAhB,IAAmC,CAAtC,EAAwC;AACpC5C,6BAAKmC,kBAAL,GAA0B,GAAGY,MAAH,CAAU/C,KAAKmC,kBAAf,EAAmCG,aAAnC,CAA1B;AACH;AACJ;AAEDF,2CAA2BG,UAAUI,KAAV,CAAgBC,eAAhB,CAA3B;AACAP,8CAA8BE,UAAUM,aAAxC;AACH,aAjBD;AAkBA,mBAAO7C,IAAP;AACH,SA9CkB,CAAnB;AA+CA,YAAIgD,WAAS,CAAC5C,KAAKC,GAAL,CAASC,OAAT,KAAmBH,YAApB,EAAkC8C,OAAlC,CAA0C,CAA1C,CAAb;AACAvD,eAAOwD,SAAP,CAAiB,0CAAwCF,QAAzD;AACA,eAAOxC,WAAP;AACH;AAtDM,CAAX;AAyDA2C,OAAOC,OAAP,GAAiBpD,IAAjB","file":"room.js","sourcesContent":["let output = require('./output')\r\nlet towers = require('./tower')\r\nlet terrain = require('./terrain')\r\n\r\nlet settings = require('./settings').getSettingsForLevel()\r\n\r\nlet room = {\r\n    init: (rooms)=>{\r\n        let subTimeStart=Game.cpu.getUsed();\r\n        output.energyInRooms(rooms)\r\n        let returnvalue =  _.map(rooms, room =>{\r\n            // Set amount of enemys in a room\r\n            let closestHostiles = room.find(FIND_HOSTILE_CREEPS)\r\n            Memory.enemys[room.name] = _.size(closestHostiles)\r\n\r\n            // Run Tower for specific ID\r\n            towers.getTower(room)\r\n            room = terrain.read(room)\r\n\r\n            room.canBuildMediumCreep = room.energyAvailable >= settings.generalSettings.costs.medium\r\n            room.canBuildBigCreep = room.energyAvailable >= settings.generalSettings.costs.big\r\n\r\n            let containers = room.find(FIND_STRUCTURES, {\r\n                filter: (structure) => {\r\n                    return structure.structureType === STRUCTURE_CONTAINER\r\n                }\r\n            })\r\n\r\n            if(room.containerToTransfer === undefined){\r\n                room.containerToTransfer = []\r\n            }\r\n            if(room.containerToGetFrom === undefined){\r\n                room.containerToGetFrom = []\r\n            }\r\n\r\n            let energyAmountInContainer = 0\r\n            let energyMaxAmountInContainer = 0\r\n            containers.map(container =>{\r\n                let containerData = [{\r\n                    \"pos\":container.pos,\r\n                    \"isFull\": true\r\n                }]\r\n                if(container.id !== Memory.proxyContainer.id){\r\n                    if(container.store[RESOURCE_ENERGY] < container.storeCapacity) {\r\n                        containerData[0].isFull = false\r\n                        room.containerToTransfer = [].concat(room.containerToTransfer, containerData)\r\n                    }\r\n                    if(container.store[RESOURCE_ENERGY] > 0){\r\n                        room.containerToGetFrom = [].concat(room.containerToGetFrom, containerData)\r\n                    }\r\n                }\r\n\r\n                energyAmountInContainer += container.store[RESOURCE_ENERGY]\r\n                energyMaxAmountInContainer += container.storeCapacity\r\n            })\r\n            return room\r\n        })\r\n        let duration=(Game.cpu.getUsed()-subTimeStart).toFixed(0);\r\n        output.workTimes(\"ROOM INIT TOOK                       \"+duration)\r\n        return returnvalue\r\n    }\r\n}\r\n\r\nmodule.exports = room"]}