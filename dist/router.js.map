{"version":3,"sources":["router.ts"],"names":["output","require","settings","getSettingsForLevel","routerHelp","routeCreep","creep","target","visual","locStr","pos","x","y","createPath","path","JSON","parse","Memory","paths","room","name","length","moveByPath","undefined","findPath","stringify","creattime","Game","time","generalSettings","newRouteOutdateCounter","findPathTo","_","merge","maxOps","ignoreDestructibleStructures","module","exports"],"mappings":";;AAAA,IAAIA,SAASC,QAAQ,UAAR,CAAb;AACA,IAAIC,WAAWD,QAAQ,YAAR,EAAsBE,mBAAtB,EAAf;AAEA;AACA,IAAIC,aAAa;AACbC,gBAAY,oBAACC,KAAD,EAAQC,MAAR,EAAgBC,MAAhB,EAAsB;AAC9B,YAAIC,SAASH,MAAMI,GAAN,CAAUC,CAAV,GAAY,GAAZ,GAAgBL,MAAMI,GAAN,CAAUE,CAA1B,GAA4B,GAA5B,GAAgCL,OAAOG,GAAP,CAAWC,CAA3C,GAA6C,GAA7C,GAAiDJ,OAAOG,GAAP,CAAWE,CAAzE;AACAR,mBAAWS,UAAX,CAAsBP,KAAtB,EAA6BC,MAA7B,EAAqCC,MAArC,EAA6CC,MAA7C;AACA,YAAIK,OAAOC,KAAKC,KAAL,CAAWC,OAAOC,KAAP,CAAaZ,MAAMa,IAAN,CAAWC,IAAxB,EAA8BX,MAA9B,EAAsCK,IAAjD,CAAX;AACA,YAAIA,KAAKO,MAAT,EAAkB;AACdf,kBAAMgB,UAAN,CAAiBR,IAAjB;AACH;AACJ,KARY;AASbD,gBAAY,oBAACP,KAAD,EAAQC,MAAR,EAAgBC,MAAhB,EAAwBC,MAAxB,EAA8B;AACtC,YAAGQ,OAAOC,KAAP,CAAaZ,MAAMa,IAAN,CAAWC,IAAxB,EAA8BX,MAA9B,MAA0Cc,SAA7C,EAAuD;AACnD,gBAAIT,OAAOV,WAAWoB,QAAX,CAAoBlB,KAApB,EAA2BC,MAA3B,EAAmCC,MAAnC,CAAX;AACAS,mBAAOC,KAAP,CAAaZ,MAAMa,IAAN,CAAWC,IAAxB,EAA8BX,MAA9B,IAAwC;AACpCK,sBAAMC,KAAKU,SAAL,CAAeX,IAAf,CAD8B;AAEpCY,2BAAUC,KAAKC;AAFqB,aAAxC;AAIH,SAND,MAMM,IAAGD,KAAKC,IAAL,GAAYX,OAAOC,KAAP,CAAaZ,MAAMa,IAAN,CAAWC,IAAxB,EAA8BX,MAA9B,EAAsCiB,SAAlD,GAA8DxB,SAAS2B,eAAT,CAAyBC,sBAA1F,EAAiH;AACnH,gBAAIhB,QAAOV,WAAWoB,QAAX,CAAoBlB,KAApB,EAA2BC,MAA3B,EAAmCC,MAAnC,CAAX;AACAS,mBAAOC,KAAP,CAAaZ,MAAMa,IAAN,CAAWC,IAAxB,EAA8BX,MAA9B,IAAwC;AACpCK,sBAAMC,KAAKU,SAAL,CAAeX,KAAf,CAD8B;AAEpCY,2BAAUC,KAAKC;AAFqB,aAAxC;AAIH;AACJ,KAvBY;AAwBbJ,cAAU,kBAAClB,KAAD,EAAQC,MAAR,EAAgBC,MAAhB,EAAsB;AAC5B,YAAIM,OAAOR,MAAMI,GAAN,CAAUqB,UAAV,CAAqBxB,MAArB,EAA6ByB,EAAEC,KAAF,CAAQzB,MAAR,EAAgB,EAAC0B,QAAQ,GAAT,EAAhB,CAA7B,CAAX;AACA,YAAI,CAACpB,KAAKO,MAAV,EAAkB;AACdP,mBAAOR,MAAMI,GAAN,CAAUqB,UAAV,CAAqBxB,MAArB,EAA6ByB,EAAEC,KAAF,CAAQzB,MAAR,EAAgB,EAAC0B,QAAQ,IAAT,EAAeC,8BAA8B,IAA7C,EAAhB,CAA7B,CAAP;AACH;AACD,eAAOrB,IAAP;AACH;AA9BY,CAAjB;AAiCAsB,OAAOC,OAAP,GAAiBjC,UAAjB","file":"router.js","sourcesContent":["let output = require('./output')\r\nlet settings = require('./settings').getSettingsForLevel()\r\n\r\n//TODO Implement own cache for routes\r\nlet routerHelp = {\r\n    routeCreep: (creep, target, visual)=>{\r\n        let locStr = creep.pos.x+\",\"+creep.pos.y+\",\"+target.pos.x+\",\"+target.pos.y\r\n        routerHelp.createPath(creep, target, visual, locStr)\r\n        let path = JSON.parse(Memory.paths[creep.room.name][locStr].path)\r\n        if( path.length ) {\r\n            creep.moveByPath(path);\r\n        }\r\n    },\r\n    createPath: (creep, target, visual, locStr)=>{\r\n        if(Memory.paths[creep.room.name][locStr] === undefined){\r\n            let path = routerHelp.findPath(creep, target, visual)\r\n            Memory.paths[creep.room.name][locStr] = {\r\n                path: JSON.stringify(path),\r\n                creattime:Game.time\r\n            }\r\n        }else if(Game.time - Memory.paths[creep.room.name][locStr].creattime > settings.generalSettings.newRouteOutdateCounter){\r\n            let path = routerHelp.findPath(creep, target, visual)\r\n            Memory.paths[creep.room.name][locStr] = {\r\n                path: JSON.stringify(path),\r\n                creattime:Game.time\r\n            }\r\n        }\r\n    },\r\n    findPath: (creep, target, visual)=>{\r\n        let path = creep.pos.findPathTo(target, _.merge(visual, {maxOps: 200}));\r\n        if( !path.length) {\r\n            path = creep.pos.findPathTo(target, _.merge(visual, {maxOps: 1000, ignoreDestructibleStructures: true}));\r\n        }\r\n        return path\r\n    }\r\n}\r\n\r\nmodule.exports = routerHelp\r\n"]}