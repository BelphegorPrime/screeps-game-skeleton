{"version":3,"sources":["role.harvester.ts"],"names":["output","require","routerHelper","roleHarvester","run","creep","carry","energy","carryCapacity","subTimeHarvesterDelivery","Game","cpu","getUsed","deliver","durationHarvesterRunDelivery","toFixed","writeToDebug","subTimeHarvesterGetEnergy","getEnergy","durationHarvesterRunGetEnergy","room","energyAvailable","energyCapacityAvailable","_","size","containerToTransfer","towers","find","FIND_STRUCTURES","filter","structure","structureType","energyCapacity","length","transfer","RESOURCE_ENERGY","ERR_NOT_IN_RANGE","routeCreep","visualizePathStyle","stroke","upgradeController","controller","containers","store","storeCapacity","target","pos","findClosestByRange","STRUCTURE_EXTENSION","STRUCTURE_SPAWN","FIND_DROPPED_ENERGY","pickup","memory","source","undefined","withdraw","harvest","fallbackSource","ticksToRegeneration","proxysource","FIND_SOURCES","module","exports"],"mappings":"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","file":"role.harvester.js","sourcesContent":["let output = require('./output')\r\nlet routerHelper = require('./router')\r\nlet roleHarvester = {\r\n\r\n    // TODO OPTIMISE RUN FUNCTION\r\n    run: (creep:Creep) =>{\r\n        if(creep.carry.energy === creep.carryCapacity || creep.carry.energy >= 50) {\r\n            let subTimeHarvesterDelivery=Game.cpu.getUsed();\r\n            roleHarvester.deliver(creep)\r\n            let durationHarvesterRunDelivery=(Game.cpu.getUsed()-subTimeHarvesterDelivery).toFixed(0);\r\n            if(durationHarvesterRunDelivery > 1){\r\n                output.writeToDebug(\"HARVESTER---DELIVERY-------->\"+durationHarvesterRunDelivery)\r\n            }\r\n        } else {\r\n            let subTimeHarvesterGetEnergy=Game.cpu.getUsed();\r\n            roleHarvester.getEnergy(creep)\r\n            let durationHarvesterRunGetEnergy=(Game.cpu.getUsed()-subTimeHarvesterGetEnergy).toFixed(0);\r\n            if(durationHarvesterRunGetEnergy > 1){\r\n                output.writeToDebug(\"HARVESTER---GETENERGY------->\"+durationHarvesterRunGetEnergy)\r\n            }\r\n        }\r\n\r\n    },\r\n    deliver: (creep:Creep) =>{\r\n        if(creep.room.energyAvailable === creep.room.energyCapacityAvailable){\r\n            if(_.size(creep.room.containerToTransfer) <= 0){\r\n                let towers = creep.room.find(FIND_STRUCTURES, {\r\n                    filter: (structure:Tower|Structure) => {\r\n                        return (structure.structureType === \"tower\") &&\r\n                            (structure.energy < structure.energyCapacity)\r\n                    }\r\n                })\r\n                if(towers.length > 0) {\r\n                    if(creep.transfer(towers[0], RESOURCE_ENERGY) === ERR_NOT_IN_RANGE) {\r\n                        routerHelper.routeCreep(creep, towers[0], {visualizePathStyle: {stroke: '#ffffff'}})\r\n                    }\r\n                }else {\r\n                    if(creep.upgradeController(creep.room.controller) === ERR_NOT_IN_RANGE) {\r\n                        routerHelper.routeCreep(creep, creep.room.controller, {visualizePathStyle: {stroke: '#ffffff'}})\r\n                    }\r\n                }\r\n            }else {\r\n                let containers = creep.room.find(FIND_STRUCTURES, {\r\n                    filter: (structure:Container|Structure) => {\r\n                        return structure.structureType === \"container\" && structure.store[RESOURCE_ENERGY] < structure.storeCapacity\r\n                    }\r\n                })\r\n                if(containers.length > 0) {\r\n                    if(creep.transfer(containers[0], RESOURCE_ENERGY) === ERR_NOT_IN_RANGE) {\r\n                        routerHelper.routeCreep(creep, containers[0], {visualizePathStyle: {stroke: '#ffffff'}})\r\n                    }\r\n                }else{\r\n                    if(creep.upgradeController(creep.room.controller) === ERR_NOT_IN_RANGE) {\r\n                        routerHelper.routeCreep(creep, creep.room.controller, {visualizePathStyle: {stroke: '#ffffff'}})\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        let target = creep.pos.findClosestByRange(FIND_STRUCTURES, {\r\n            filter: (structure:Extension|Spawn|Structure) => {\r\n                return (structure.structureType === STRUCTURE_EXTENSION ||\r\n                    structure.structureType === STRUCTURE_SPAWN) &&\r\n                    (structure.energy < structure.energyCapacity)\r\n            }\r\n        })\r\n        if(target!==null){\r\n            if(creep.transfer(target, RESOURCE_ENERGY) === ERR_NOT_IN_RANGE) {\r\n                routerHelper.routeCreep(creep, target, {visualizePathStyle: {stroke: '#ffffff'}})\r\n            }\r\n        }\r\n    },\r\n    getEnergy: (creep:Creep)=>{\r\n        let target = creep.pos.findClosestByRange(FIND_DROPPED_ENERGY);\r\n        if(target) {\r\n            if(creep.pickup(target) === ERR_NOT_IN_RANGE) {\r\n                routerHelper.routeCreep(creep, target, {visualizePathStyle: {stroke: '#ffaa00'}})\r\n            }\r\n        }else{\r\n            if(creep.memory.source !== undefined){\r\n                if(creep.memory.source.structureType === \"container\"){\r\n                    if(creep.memory.source.store.energy > 0){\r\n                        if(creep.withdraw(creep.memory.source, RESOURCE_ENERGY) === ERR_NOT_IN_RANGE) {\r\n                            routerHelper.routeCreep(creep, creep.memory.source, {visualizePathStyle: {stroke: '#ffaa00'}})\r\n                        }\r\n                    }else{\r\n                        if(creep.harvest(creep.memory.fallbackSource) === ERR_NOT_IN_RANGE) {\r\n                            routerHelper.routeCreep(creep, creep.memory.fallbackSource, {visualizePathStyle: {stroke: '#ffaa00'}})\r\n                        }\r\n                    }\r\n                }else{\r\n                    if(creep.memory.source.ticksToRegeneration > 75 && creep.memory.source.energy === 0){\r\n                        if(creep.harvest(creep.memory.proxysource) === ERR_NOT_IN_RANGE) {\r\n                            routerHelper.routeCreep(creep, creep.memory.proxysource, {visualizePathStyle: {stroke: '#ffaa00'}})\r\n                        }\r\n                    }else {\r\n                        if(creep.harvest(creep.memory.source) === ERR_NOT_IN_RANGE) {\r\n                            routerHelper.routeCreep(creep, creep.memory.source, {visualizePathStyle: {stroke: '#ffaa00'}})\r\n                        }\r\n                    }\r\n                }\r\n            }else{\r\n                let source = creep.pos.findClosestByRange(FIND_SOURCES)\r\n                if(creep.harvest(source) === ERR_NOT_IN_RANGE) {\r\n                    routerHelper.routeCreep(creep, source, {visualizePathStyle: {stroke: '#ffaa00'}})\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = roleHarvester"]}